"use strict";define("pages/open-course/supplement/views/supplement",["require","exports","module","jquery","underscore","bundles/CMLConverter/CMLVariableNames","bundles/content-feedback/components/ItemFeedback","bundles/content-feedback/constants/ItemTypes","bundles/ondemand/actions/ProgressActions","bundles/ondemand/appContextSingleton","bundles/phoenix/lib/renderContent","bundles/phoenix/lib/view","bundles/phoenix/template/models/userIdentity","js/lib/coursera.mathjax","js/lib/metatags","pages/open-course/common/constants","pages/open-course/supplement/utils/supplementProgressApi","pages/open-course/supplement/views/supplement.html","css!pages/open-course/supplement/styl/supplement.css"],function(require,exports,module){var $=require("jquery"),_=require("underscore"),t=require("bundles/CMLConverter/CMLVariableNames"),p=require("bundles/content-feedback/components/ItemFeedback"),n=require("bundles/content-feedback/constants/ItemTypes"),l=require("bundles/ondemand/actions/ProgressActions"),o=l.updateProgress,i=require("bundles/ondemand/appContextSingleton"),r=require("bundles/phoenix/lib/renderContent"),a=require("bundles/phoenix/lib/view"),e=require("bundles/phoenix/template/models/userIdentity"),s=require("js/lib/coursera.mathjax"),m=require("js/lib/metatags"),d=require("pages/open-course/common/constants"),u=require("pages/open-course/supplement/utils/supplementProgressApi"),c=require("pages/open-course/supplement/views/supplement.html");require("css!pages/open-course/supplement/styl/supplement.css");var g="supplement_link_tracking",b=a.extend({name:"itemView",template:c,bodyClasses:"c-item-supplement",events:{"click .c-open-single-page a":"setTargetAttrForLink"},initialize:function initialize(e){this.setOptions(e),this.listenTo(this,"view:appended",function(){s.render(this.$el[0])}),m.setCommon({title:this.model.get("metadata").getName()+" | Coursera",description:this.model.get("metadata.lesson.module.description"),pageHref:window.location.href})},renderSubviews:function renderSubviews(){this.renderReactViews()},postRender:function postRender(){this.markComplete()},renderReactViews:function renderReactViews(){var o={typeName:this.model.get("typeName"),definition:this.model.get("definition")},s={};s[t.NAME]=e.get("full_name"),s[t.USER_ID]=e.get("id");var i={variableData:s,linkEventingData:{key:g,value:{course_slug:this.model.get("metadata.course.slug"),user_id:e.get("id"),timestamp:_.now()}}};r(o,this.$$("content"),i),this.renderReactInto(p,"ItemFeedback",{itemId:this.model.get("metadata.id"),itemType:n.Reading})},setTargetAttrForLink:function setTargetAttrForLink(e){$(e.currentTarget).attr("target","_blank")},setOptions:function setOptions(e){this.courseProgress=e.courseProgress,this.model=e.model},markComplete:function markComplete(){var e=this.model.get("metadata.id"),t=this.courseProgress.getItemProgress(e);t.isComplete()||u.markComplete(e).then(function(){t.setState(d.progressCompleted,{refreshCourseProgress:!0}),i.getComponentContext().executeAction(o,this.courseProgress)}.bind(this)).done()}});module.exports=b});